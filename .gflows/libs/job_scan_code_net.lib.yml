#@ load("common.lib.yml", "common")
#@ load("configuration.lib.yml", "cfg")
---
#@ def generate_scan_code_net_job_steps(scan_code_net, sections):
#@ test_result_artifacts = []

#@ for unit_test_section in getattr(sections,"unit_test",[]):
#@ test_result_artifacts.append("{} results".format(unit_test_section.name))
#@ end 

#@ if hasattr(sections,"integration_test") :
  #@ for integration_test_definition in sections.integration_test:
      #@ test_result_artifacts.append("{} results".format(integration_test_definition.name))
  #@ end
#@ end

- name: Checkout repository
  uses: actions/checkout@v2
  with:
    fetch-depth: 0
- name: Scan
  uses: NazmiAltun/dotnet-parallel-sonar-scan@v1.0.2
  with:
    sonar-token: #@ cfg.get_sonar_token(scan_code_net)
    test-result-artifacts: #@ ",".join(test_result_artifacts)
#@ if hasattr(scan_code_net,"organisation") :
    organization: #@ cfg.get_sonar_organisation(scan_code_net)
#@ end
#@ if hasattr(scan_code_net,"project") :
    project-key: #@ cfg.get_sonar_project(scan_code_net)
#@ end
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#@ end
---
#@ def generate_scan_code_net_job(scan_code_net, sections):
#@ steps = generate_scan_code_net_job_steps(scan_code_net, sections)
#@ needs = ["version"]
#@ return common.generate_job(scan_code_net, steps, None, sections, needs, "Sonar scan")
#@ end
---
